# 系统架构

Leapmotion控制器(硬件)支持所有主流PC操作系统。leapmotion软件在Windows上作为一个服务运行,在Mac和Linux则作为后台程序运行。leapmotion的软件通过usb接口来识别读取leapmotion控制器的数据。leapmotion SDK提供了两种方式来获得leapmotion数据:本机接口和WebSocket接口。这些api使您能够创建Leap-enabled应用程序在多个编程语言包括在浏览器中运行的JavaScript环境。　　　　

*注意:leapmotion服务/后台程序与应用程序在本地主机上使用TCP IP通信(127.0.0.1)和端口:6437,6438和6439。这个地址和端口不能被防火墙或其他程序占用。*

The software connects to the Leap Motion Controller device over the USB bus. Leap-enabled applications access the Leap Motion service to receive motion tracking data. The Leap Motion SDK provides two varieties of API for getting the Leap Motion data: a native interface and a WebSocket interface. These APIs enable you to create Leap-enabled applications in several programming languages including JavaScript running in a browser environment.

### 应用程序接口

上面有说到,Leapmotion的SDK提供两种方式:本地接口和WebSocket接口,来获取到追踪的数据.

本地接口是一个dll文件,你可以使用这个动态文件库来创建可以使用Leap的新程序.
WebSocket接口和对应的Javascript库则能让你创建可以使用Leap的web程序.

#### 本地接口

![Leap-enabled applications](https://developer.leapmotion.com/documentation/images/Arch_OS_Level_Diagram.png)

本地应用程序接口是一个动态库,这个库其实就是一个dll文件,用于动态载入各种不同的语言程序,你可以用它来载入c++,objective-c或者是java,C#和python.

1. Leapmotion Service(windows后台服务)会从USB接口上的Leapmotion设备接收数据,然后处理并返回给对应的语言库.默认情况下,服务只会给前台的应用程序返回相应的追踪数据,而应用程序在后台也可以通过请求来获取到相应的数据.
2. 我们编写出来的支持leap操作的应用程序和Leap本身的后台程序是分离运行的,所以允许电脑用户来控制leapmotion的安装.而Leapmotion应用程序在windows下其实是一个控制面板程序,而在Mac OS X下是一个菜单栏应用程序.
3. Leapmotion前台应用程序用于接受Leap数据.一个支持Leap的程序能够使用Leapmotion本地的程序库来连接上Leapmotion的后台程序.
4. 当我们编写出来的Leap应用程序没有被系统focus时,就是程序最小化或者不是当前的聚焦操作窗口,那么Leapmotion服务就会停止输送数据给后台,应用程序就相当于暂停了.如果需要应用程序在后台工作时也接收相应的数据则需要在前台进行相应的设置.


#### WebSocket接口

The Leap Motion service runs a WebSocket server on the localhost domain at port 6437. The WebSocket interface provides tracking data in the form of JSON messages. A JavaScript client library is available that consumes the JSON messages and presents the tracking data as regular JavaScript objects.


![Leap-enabled web applications](https://developer.leapmotion.com/documentation/images/Arch_WebSocket_Diagram.png)

+ The Leap Motion service provides a WebSocket server listening on http://127.0.0.1:6437.
+ The Leap Motion control panel allows end users to enable or disble the WebSocket server.
+ The server sends tracking data in the form of JSON messages. An application can send configuration messages back to the server.

The leap.js client JavaScript library should be used in web applications. The library establishes the connection to the server and consumes the JSON messages. The API presented by the JavaScript library is similar in philosophy and structure to the native API.
This interface is intended primarily for web applications, but any application that can establish a WebSocket connection can use it. The server conforms to RFC6455.

Programming Language Support
The Leap Motion library is written in C++. Leap Motion also uses SWIG, an open source tool, to generate language bindings for C#, Java, and Python. The SWIG-generated bindings translate calls written in the bound programming language to calls into the base C++ Leap Motion library. Each SWIG binding uses two additional libraries. For JavaScript and web application development, Leap Motion provides a WebSocket server and a client-side JavaScript library.

All the library, code, and header files required to develop Leap-enabled applications and plug-ins are included in the Leap Motion SDK, except the leap.js client JavaScript library. You can download the Leap Motion SDK from the Leap Motion Developer Portal. An SDK package is available for each supported operating system. The JavaScript client library is distributed separately and can be downloaded from the LeapJS GitHub repository.

### C++
To develop for the Leap Motion Controller in C++, include the API header files in your program and link with the Leap Motion library, either libLeap.dylib, Leap.dll, or libLeap.so, depending on platform.

On Windows, separate libraries are provided for 32-bit versus 64-bit architectures as well as debug builds versus release builds (for a total of 4 versions for each component).

On Mac OS X, both architectures and release modes are supported in a single library file. However, two versions of libLeap.dylib are supplied: one supporting libstdc++, the other supporting libc++.

### Objective-C
Objective-C applications are supported by hand-written wrapper code. To build a Leap-enabled Objective-C application, include the wrapper header and Objective-C++ code file in your application along with the Leap Motion C++ headers. You can then use the classes defined in the wrapper in (otherwise) pure Objective-C applications. Link your application with libLeap.dylib and include the library in your application package.

### C#
The C# class definitions are provided for .NET 3.5 and .NET 4.0 in separate libraries. Your code can reference either LeapCSharp.NET3.5.dll or LeapCSharp.NET4.0.dll (the same library names are used for this library on all supported operating systems). These libraries load libCSharp.dylib (Mac), LeapCSharp.dll (Windows), or libLeapCSharp.so (Linux). The intermediate libraries load libLeap.dylib, Leap.dll, or libLeap.so (depending on platform).

Use the .NET 3.5 libraries with the Unity 3D game development system. The Leap Motion SDK provides a Unity plugin for use with the “Pro” version of the Unity editor. See this knowledgebase article for information on developing Leap-enabled applications with versions of the Unity editor that do not support plug-ins.

### Java
Leap.jar contains the Leap Motion Java classes. This code loads libLeapJava.dylib (Mac), LeapJava.dll (Windows), or libLeapJava.so (Linux). These libraries contain the native code that translates the Java calls to the base Leap Motion API in libLeap.dylib, Leap.dll, or libLeap.so (depending on platform). The base Leap Motion dynamic library is loaded by the intermediate library.

### Python
Leap.py contains the Python module that you reference in your Python application. This module loads LeapPython.so (Mac and Linux) or LeapPython.dll (Windows). These libraries load libLeap.dylib, Leap.dll, or libLeap.so (depending on platform).

### JavaScript
Leap Motion JavaScript support has two main components. The first component is the WebSocket server provided by the Leap Motion service. This server allows web applications (or any application that can connect to a WebSocket) to access Leap Motion tracking data as JSON-formatted messages. The second component is the JavaScript client library, Leap.js. Leap.js is an open-source JavaScript API that consumes the WebSocket JSON output and presents it in a form that is consistent in philosophy and structure to the native Leap Motion API.

### Other Languages
Many community-created language bindings are available, for a partial list, visit: Community Libraries.

Operating System Support
The Leap Motion software currently supports OS X 10.7+ and Windows 7+. There is also a beta-quality Linux build intended for developers.